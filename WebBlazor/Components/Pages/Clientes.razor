@page "/clientes"
@rendermode InteractiveServer
@using Data.DTOs
@using Data.Modelo
@using Domain.Services
@inject ClienteService ClienteService
@inject DialogService DialogService

<PageTitle>Clientes</PageTitle>

<RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween" Class="rz-mb-4">
    <RadzenText TextStyle="TextStyle.H3" TagName="TagName.H1" Class="rz-m-0">Clientes</RadzenText>
    <RadzenButton Text="Agregar Cliente" Icon="add_circle" Click="@AbrirDialogoAgregar" ButtonStyle="ButtonStyle.Primary" />
</RadzenStack>

<RadzenDataGrid Data="@clientes" TItem="ClienteDTO" RowSelect="@(args => AbrirDialogoEditar(args.Id))" AllowPaging="true" PageSize="10" Style="cursor:pointer">
    <Columns>
        <RadzenDataGridColumn TItem="ClienteDTO" Property="Id" Title="ID" Width="80px" />
        <RadzenDataGridColumn TItem="ClienteDTO" Property="Nombre" Title="Nombre" />
        <RadzenDataGridColumn TItem="ClienteDTO" Property="Email" Title="Email" />
        <RadzenDataGridColumn TItem="ClienteDTO" Property="Telefono" Title="Teléfono" />
    </Columns>
</RadzenDataGrid>
   

@code {
    private IEnumerable<ClienteDTO> clientes;

    protected override void OnInitialized() => CargarDatos();

    private void CargarDatos()
    {
        clientes = ClienteService.GetClientesFiltrados();
    }

    private async Task AbrirDialogoAgregar()
    {
        var res = await DialogService.OpenAsync<ClienteFormDialog>("Nuevo Cliente",
            new Dictionary<string, object> {
                { "cliente", new Cliente() },
                { "EsEdicion", false }
            });

        if (res == true) CargarDatos();
    }

    private async Task AbrirDialogoEditar(int id)
    {
        var clienteAEditar = ClienteService.Repository.GetCliente(id);

        var res = await DialogService.OpenAsync<ClienteFormDialog>($"Editar Cliente #{id}",
            new Dictionary<string, object> {
                { "cliente", clienteAEditar },
                { "EsEdicion", true }
            });

        if (res == true) CargarDatos();
    }

}