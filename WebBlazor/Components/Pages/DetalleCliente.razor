@page "/clientes/detalle/{Id:int}"
@rendermode InteractiveServer
@using Data.DTOs
@using Data.Modelo
@using Domain.Services
@inject ClienteService ClienteService
@inject CategoriaService CategoriaService
@inject NavigationManager NavigationManager

<PageTitle>Detalle del Cliente</PageTitle>

<RadzenText TextStyle="TextStyle.H3">Información del Cliente</RadzenText>


    <RadzenTemplateForm TItem="Cliente" Data=@cliente Submit=@OnSave>
        <RadzenStack Gap="1rem">

            <RadzenFormField Text="Id">
                <RadzenNumeric @bind-Value="@cliente.Id" ReadOnly="true" Name="Nombre" Style="width: 100%;" />
            </RadzenFormField>

            <RadzenFormField Text="Nombre">
                <RadzenTextBox @bind-Value="@cliente.Nombre" Name="Nombre" Style="width: 100%;" />
            </RadzenFormField>

            <RadzenFormField Text="Email">
                <RadzenTextBox @bind-Value="@cliente.Email" Name="Email" Style="width: 100%;" />
            </RadzenFormField>

            <RadzenFormField Text="Teléfono">
                <RadzenTextBox @bind-Value="@cliente.Telefono" Name="Telefono" Style="width: 100%;" />
            </RadzenFormField>

            <RadzenFormField Text="Categoría">
                <RadzenDropDown @bind-Value="@cliente.Categoria"
                                Data="@listaCategorias"
                                TextProperty="Nombre"
                                ValueProperty="Id"
                                Style="width: 100%;"
                                Placeholder="Seleccione una categoría" />
            </RadzenFormField>

            <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem">
                <RadzenButton ButtonType="ButtonType.Submit" Text="Guardar Cambios" Icon="save" />
                <RadzenButton ButtonStyle="ButtonStyle.Light" Text="Volver" Click=@(args => NavigationManager.NavigateTo("/clientes")) />
                <RadzenButton ButtonStyle="ButtonStyle.Danger" Text="Eliminar" Icon="delete" Click=@Delete />
            </RadzenStack>

        </RadzenStack>
    </RadzenTemplateForm>


@code {
    [Parameter] public int Id { get; set; }
    private Cliente? cliente;
    private IEnumerable<Categoria>? listaCategorias;

    protected override void OnInitialized()
    {
        cliente = ClienteService.Repository.GetCliente(Id);
        listaCategorias = CategoriaService.GetCategorias();
    }

    private void OnSave()
    {
        ClienteService.Repository.UpdateCliente(cliente);
        NavigationManager.NavigateTo("/clientes");
    }

    private void Delete()
    {
        ClienteService.Repository.DeleteCliente(cliente.Id);
        NavigationManager.NavigateTo("/clientes");
    }
}
